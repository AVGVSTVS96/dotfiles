# oh-my-posh Theme Reset Issue

## Problem

After periods of inactivity (1-2 days), oh-my-posh reverts to the default theme instead of the custom theme. Running `source ~/.zshrc` fixes it immediately.

## Root Cause

oh-my-posh stores the theme configuration in a **session cache** file at `~/.cache/oh-my-posh/zsh.<SESSION_ID>.omp.cache`. The `CONFIG` and `CONFIG_SOURCE` entries in this cache have a TTL (time-to-live) that is hardcoded in oh-my-posh.

After extended inactivity, these cache entries expire. When you run a command, oh-my-posh tries to render the prompt but can't find the config in cache, so it falls back to the default theme.

## Evidence

### Working session cache contains:
```
CONFIG_SOURCE
string
/Users/bassimshahidy/.config/oh-my-posh/tokyonight_storm-customized.omp.json
```

### Broken session cache contains:
```
template_cache
(NO CONFIG or CONFIG_SOURCE entries)
```

### Key observation:
- `_omp_get_prompt` function (generated by `oh-my-posh init`) does NOT include `--config` flag
- oh-my-posh relies entirely on the session cache to remember which config to use
- When the cache entry expires, the config path is lost

## The Fix

Override `_omp_get_prompt` after init to always pass `--config` explicitly:

```zsh
# ------------------
# --- oh-my-posh ---
# ------------------
_omp_config="$HOME/.config/oh-my-posh/tokyonight_storm-customized.omp.json"
eval "$(oh-my-posh init zsh --config $_omp_config)"

# Fix: oh-my-posh session cache expires after inactivity, losing the config.
# Override _omp_get_prompt to always pass --config explicitly.
_omp_get_prompt() {
  local type=$1
  local args=("${@[2,-1]}")
  $_omp_executable print $type \
    --config="$_omp_config" \
    --save-cache \
    --shell=zsh \
    --shell-version=$ZSH_VERSION \
    --status=$_omp_status \
    --pipestatus="${_omp_pipestatus[*]}" \
    --no-status=$_omp_no_status \
    --execution-time=$_omp_execution_time \
    --job-count=$_omp_job_count \
    --stack-count=$_omp_stack_count \
    --terminal-width="${COLUMNS-0}" \
    ${args[@]}
}
```

## Debug Commands

To diagnose this issue in the future:

```zsh
# Check session ID and cache file
echo "POSH_SESSION_ID: $POSH_SESSION_ID"
ls -la ~/.cache/oh-my-posh/zsh.$POSH_SESSION_ID.omp.cache

# Check if CONFIG is in the cache (should show config path if working)
cat ~/.cache/oh-my-posh/zsh.$POSH_SESSION_ID.omp.cache | strings | grep -i "\.omp\.json"

# Check if _omp_get_prompt has --config (it won't by default)
typeset -f _omp_get_prompt | grep config

# Test if oh-my-posh can render the theme directly
oh-my-posh print primary --config ~/.config/oh-my-posh/tokyonight_storm-customized.omp.json
```

## Related

- GitHub Issue: [omp.cache file has old cache entries which cause the prompt to intermittently malfunction #5656](https://github.com/JanDeDobbeleer/oh-my-posh/issues/5656)
- oh-my-posh version when diagnosed: 27.5.2
